import displayNotification from"./modules/notification.js";import phoneFormatter from"./modules/phone_format.js";import initButtonAnimation from"./modules/button-animation.js";phoneFormatter();let{animateButton,resetButton}=initButtonAnimation(),form=document.getElementById("my-form");async function handleSubmit(e,t){var a,o,n;e.preventDefault(),form?validateFormData(e={email:document.getElementById("email").value,phone:document.getElementById("phone").value.replace(/\D/g,""),name:document.getElementById("name").value,message:document.getElementById("message").value})&&((a=form.querySelector('button[type="submit"]'))&&(a.disabled=!0),o=""+Date.now()+Math.floor(1e6*Math.random()).toString(36),(n=new FormData).append("name",e.name),n.append("email",e.email),n.append("phone",e.phone),n.append("message",e.message),n.append("g-recaptcha-response",t),n.append("uniqueID",o),await sendDataToServer(a,n)):console.error("Form not found.")}function validateFormData(e){return e.email||e.phone?e.email&&!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e.email)?(displayNotification("Proszę podać prawidłowy adres email.","error"),!1):!(e.phone&&!/^[0-9]{9}$/.test(e.phone)&&(displayNotification("Proszę podać prawidłowy numer telefonu (9 cyfr).","error"),1)):(displayNotification("Proszę podać adres email lub numer telefonu.","error"),!1)}async function sendDataToServer(e,t){try{var a=await(await fetch("/php/send_email.php",{method:"POST",body:t})).json();a.success?(displayNotification(a.message,"success"),setTimeout(()=>{animateButton("success")},0),setTimeout(()=>{form.reset()},5e3)):(displayNotification(a.message,"error"),setTimeout(()=>{animateButton("error")},0))}catch(e){console.error("Form submission error:",e.message,e.stack),handleError(t,e)}finally{e.disabled=!1,setTimeout(()=>{resetButton()},5e3)}}function handleError(e,t){Sentry.captureException(t,{extra:{formData:e},tags:{"form-name":"kontakt"}}),displayNotification("Wystąpił błąd. Proszę spróbować ponownie.","error")}form.addEventListener("submit",t=>{t.preventDefault(),grecaptcha.ready(()=>{grecaptcha.execute("6LeTFCAqAAAAAKlvDJZjZnVCdtD76hc3YZiIUs_Q",{action:"submit"}).then(e=>{e?handleSubmit(t,e):displayNotification("ReCAPTCHA verification failed. Please try again.","error")}).catch(e=>{console.error("ReCAPTCHA error:",e),displayNotification("ReCAPTCHA verification failed. Please try again.","error")})})});