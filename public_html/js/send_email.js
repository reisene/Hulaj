import displayNotification from"./modules/notification.js";import phoneFormatter from"./modules/phone_format.js";import initButtonAnimation from"./modules/button-animation.js";let form=document.getElementById("my-form"),{animateButton,resetButton}=initButtonAnimation();async function handleSubmit(e,t){if(e.preventDefault(),!form)return console.error("Form not found."),void Sentry.captureException(error,{extra:{url:window.location.href,referrer:document.referrer,userAgent:navigator.userAgent,formData:i}});phoneFormatter();e={email:document.getElementById("email").value,phone:document.getElementById("phone").value.replace(/\D/g,""),name:document.getElementById("name").value,message:document.getElementById("message").value};if(!validateFormData(e))return;var a=form.querySelector('button[type="submit"]'),r=(a&&(a.disabled=!0),""+Date.now()+Math.floor(1e6*Math.random()).toString(36)),o=localStorage.getItem("csrf_token"),n=new FormData;n.append("name",e.name),n.append("email",e.email),n.append("phone",e.phone),n.append("message",e.message),n.append("g-recaptcha-response",t),n.append("uniqueID",r),n.append("csrf_token",o);let i=new File([JSON.stringify(e)],"form_data.txt",{type:"text/plain"});await sendDataToServer(a,n,i)}function validateFormData(e){return e.email||e.phone?e.email&&!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e.email)?(displayNotification("Proszę podać prawidłowy adres email.","error"),!1):!(e.phone&&!/^[0-9]{9}$/.test(e.phone)&&(displayNotification("Proszę podać prawidłowy numer telefonu (9 cyfr).","error"),1)):(displayNotification("Proszę podać adres email lub numer telefonu.","error"),!1)}async function sendDataToServer(e,t,a){try{var r=await fetch("../php/send_email.php",{method:"POST",body:t});if(!r.ok)throw new Error(`Błąd ${r.status}: `+r.statusText);var o=await r.json();o.success?(displayNotification(o.message,"success"),setTimeout(()=>{animateButton("success")},0),setTimeout(()=>{form.reset()},5e3)):(displayNotification(o.message,"error"),setTimeout(()=>{animateButton("error")},0))}catch(e){console.error("Form submission error:",e.message,e.stack),handleError(a,e)}finally{e.disabled=!1,setTimeout(()=>{resetButton()},5e3)}}function handleError(e,t){Sentry.captureException(t,{attachments:[{filename:"form_data.txt",data:e,contentType:"text/plain"}],tags:{"form-name":"kontakt"},extra:{url:window.location.href,referrer:document.referrer,userAgent:navigator.userAgent,formData:e}}),t.message.includes("Błąd")?displayNotification("Wystąpił błąd. Proszę spróbować ponownie.","error"):displayNotification("Wystąpił nieoczekiwany błąd. Proszę skontaktować się z administratorem.","error")}fetch("/php/generate-token.php").then(e=>e.text()).then(e=>{localStorage.setItem("csrf_token",e);var t=document.createElement("input");t.type="hidden",t.name="csrf_token",t.value=e,form.appendChild(t)}).catch(e=>{var t={message:"Błąd pobierania tokena",url:"/php/generate-token.php",method:"GET"};Sentry.captureException(new Error(t.message),{extra:t}),console.error("Błąd pobierania tokena:",e)}),form.addEventListener("submit",t=>{t.preventDefault(),grecaptcha.ready(()=>{grecaptcha.execute("6LeTFCAqAAAAAKlvDJZjZnVCdtD76hc3YZiIUs_Q",{action:"submit"}).then(e=>{e?handleSubmit(t,e):displayNotification("ReCAPTCHA verification failed. Please try again.","error")}).catch(e=>{console.error("ReCAPTCHA error:",e),displayNotification("ReCAPTCHA verification failed. Please try again.","error")})})});export{handleSubmit,validateFormData,sendDataToServer,handleError};
//# sourceMappingURL=send_email.js.map
