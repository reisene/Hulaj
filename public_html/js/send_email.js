import displayNotification from"./modules/notification.js";import phoneFormatter from"./modules/phone_format.js";import initButtonAnimation from"./modules/button-animation.js";phoneFormatter();let{animateButton,resetButton}=initButtonAnimation(),form=document.getElementById("my-form");function validateFormData(e){return e.email||e.phone?e.email&&!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e.email)?(displayNotification("Proszę podać prawidłowy adres email.","error"),!1):!(e.phone&&!/^[0-9]{9}$/.test(e.phone)&&(displayNotification("Proszę podać prawidłowy numer telefonu (9 cyfr).","error"),1)):(displayNotification("Proszę podać adres email lub numer telefonu.","error"),!1)}function prepareFormData(){return{email:document.getElementById("email").value,phone:document.getElementById("phone").value.replace(/\D/g,""),name:document.getElementById("name").value,message:document.getElementById("message").value}}function prepareDataForSending(e,t){var a=new FormData;return a.append("name",e.name),a.append("email",e.email),a.append("phone",e.phone),a.append("message",e.message),a.append("g-recaptcha-response",t),a.append("uniqueID",""+Date.now()+Math.floor(1e6*Math.random()).toString(36)),a}function sendFormData(e){fetch("/php/send_email.php",{method:"POST",body:e}).then(e=>e.json()).then(e=>{e.success?(displayNotification(e.message,"success"),animateButton("success"),setTimeout(()=>{form.reset()},5e3)):(displayNotification(e.message,"error"),animateButton("error"))}).catch(e=>{console.error("Form submission error:",e.message,e.stack),displayNotification("Ups! Wystąpił problem z przesłaniem formularza","error")}).finally(()=>{resetButton()})}function handleButtonState(e){e.disabled=!0,setTimeout(()=>{resetButton()},5e3)}function handleReCAPTCHA(e){e?handleSubmit(e):displayNotification("ReCAPTCHA verification failed. Please try again.","error")}async function handleSubmit(e){var t,a=prepareFormData();validateFormData(a)&&((t=form.querySelector('button[type="submit"]'))&&handleButtonState(t),sendFormData(prepareDataForSending(a,e)))}form.addEventListener("submit",function(e){e.preventDefault(),grecaptcha.ready(function(){grecaptcha.execute("6LeTFCAqAAAAAKlvDJZjZnVCdtD76hc3YZiIUs_Q",{action:"submit"}).then(function(e){handleReCAPTCHA(e)}).catch(function(e){console.error("ReCAPTCHA error:",e),displayNotification("ReCAPTCHA verification failed. Please try again.","error")})})});