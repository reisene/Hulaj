import displayNotification from"./modules/notification.js";import phoneFormatter from"./modules/phone_format.js";import initButtonAnimation from"./modules/button-animation.js";phoneFormatter();let{animateButton,resetButton}=initButtonAnimation(),form=document.getElementById("my-form");async function handleSubmit(e,t){var a,o,n,r;e.preventDefault(),form?validateFormData(e={email:document.getElementById("email").value,phone:document.getElementById("phone").value.replace(/\D/g,""),name:document.getElementById("name").value,message:document.getElementById("message").value})&&((a=form.querySelector('button[type="submit"]'))&&(a.disabled=!0),o=""+Date.now()+Math.floor(1e6*Math.random()).toString(36),n=localStorage.getItem("csrf_token"),(r=new FormData).append("name",e.name),r.append("email",e.email),r.append("phone",e.phone),r.append("message",e.message),r.append("g-recaptcha-response",t),r.append("uniqueID",o),r.append("csrf_token",n),await sendDataToServer(a,r,new File([JSON.stringify(e)],"form_data.json",{type:"application/json"}))):console.error("Form not found.")}function validateFormData(e){return e.email||e.phone?e.email&&!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e.email)?(displayNotification("Proszę podać prawidłowy adres email.","error"),!1):!(e.phone&&!/^[0-9]{9}$/.test(e.phone)&&(displayNotification("Proszę podać prawidłowy numer telefonu (9 cyfr).","error"),1)):(displayNotification("Proszę podać adres email lub numer telefonu.","error"),!1)}async function sendDataToServer(e,t,a){try{var o=await fetch("/php/send_email.php",{method:"POST",body:t});if(!o.ok)throw new Error(`Błąd ${o.status}: `+o.statusText);var n=await o.json();n.success?(displayNotification(n.message,"success"),setTimeout(()=>{animateButton("success")},0),setTimeout(()=>{form.reset()},5e3)):(displayNotification(n.message,"error"),setTimeout(()=>{animateButton("error")},0))}catch(e){console.error("Form submission error:",e.message,e.stack),handleError(a,e)}finally{e.disabled=!1,setTimeout(()=>{resetButton()},5e3)}}function handleError(e,t){Sentry.captureException(t,{attachments:[{filename:"form_data.json",data:e,contentType:"application/json"}],tags:{"form-name":"kontakt"}}),t.message.includes("Błąd")?displayNotification("Wystąpił błąd. Proszę spróbować ponownie.","error"):displayNotification("Wystąpił nieoczekiwany błąd. Proszę skontaktować się z administratorem.","error")}fetch("/php/generate-token.php").then(e=>e.text()).then(e=>{localStorage.setItem("csrf_token",e);var t=document.createElement("input");t.type="hidden",t.name="csrf_token",t.value=e,form.appendChild(t)}).catch(e=>{var t={message:"Błąd pobierania tokena",url:"/php/generate-token.php",method:"GET"};Sentry.captureException(new Error(t.message),{extra:t}),console.error("Błąd pobierania tokena:",e)}),form.addEventListener("submit",t=>{t.preventDefault(),grecaptcha.ready(()=>{grecaptcha.execute("6LeTFCAqAAAAAKlvDJZjZnVCdtD76hc3YZiIUs_Q",{action:"submit"}).then(e=>{e?handleSubmit(t,e):displayNotification("ReCAPTCHA verification failed. Please try again.","error")}).catch(e=>{console.error("ReCAPTCHA error:",e),displayNotification("ReCAPTCHA verification failed. Please try again.","error")})})});