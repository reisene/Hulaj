import displayNotification from"./modules/notification.js";import phoneFormatter from"./modules/phone-format.js";import initButtonAnimation from"./modules/button-animation.js";let form=document.getElementById("my-form"),init=initButtonAnimation();function generateCsfrToken(){return fetch("/php/generate-token.php").then(e=>{if(e.ok)return e.text();throw new Error("Network response was not ok")}).then(e=>{localStorage.setItem("csrf_token",e),document.getElementById("csrf-token").value=e}).catch(e=>{var t={message:"Błąd pobierania tokena",url:"/php/generate-token.php",method:"GET"};Sentry.captureException(new Error(t.message),{extra:t})})}function checkCsrfToken(){return generateCsfrToken().then(()=>{if(localStorage.getItem("csrf_token")!==document.getElementById("csrf-token").value)return checkCsrfToken()})}async function handleSubmit(e,t){if(e.preventDefault(),form){var e=getFormData(),r=form.querySelector('button[type="submit"]');if(r){r.disabled=!0;try{await validateFormData(r,e)}catch(e){return void console.error(e)}await sendDataToServer(r,prepareData(e,t),new File([JSON.stringify(e)],"form_data.txt",{type:"text/plain"}))}else console.error("Submit button not found.")}else console.error("Form not found."),Sentry.captureException(error,{extra:{url:window.location.href,referrer:document.referrer,userAgent:navigator.userAgent,formName:"kontakt",formAction:window.location.href,formMethod:"POST"}})}function getFormData(){return{email:document.getElementById("email").value,phone:document.getElementById("phone").value.replace(/\D/g,""),name:document.getElementById("name").value,message:document.getElementById("message").value}}function prepareData(e,t){var r=""+Date.now()+Math.floor(1e6*Math.random()).toString(36),o=document.getElementById("csrf-token").value,n=new FormData;return n.append("name",e.name),n.append("email",e.email),n.append("phone",e.phone),n.append("message",e.message),n.append("g-recaptcha-response",t),n.append("uniqueID",r),n.append("csrf_token",o),n}function executeReCAPTCHA(t,e){grecaptcha.ready(()=>{grecaptcha.execute(e,{action:"submit"}).then(e=>{e?handleSubmit(t,e):displayNotification("ReCAPTCHA verification failed. Please try again.","error")}).catch(e=>{console.error("ReCAPTCHA error:",e),displayNotification("ReCAPTCHA verification failed. Please try again.","error")})})}async function validateFormData(t,e){try{var r=await(await fetch("../php/validate-data.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(r.error)throw displayNotification(r.error,"error"),setTimeout(()=>{init.resetButton()},200),new Error(r.error);return!0}catch(e){throw t.disabled=!1,e}}async function sendDataToServer(e,t,r){try{var o=await fetch("../php/send_email.php",{method:"POST",body:t});if(!o.ok)throw new Error(`Błąd ${o.status}: `+o.statusText);var n=await o.json();n.success?(displayNotification(n.message,"success"),setTimeout(()=>{init.animateButton("success")},0),setTimeout(()=>{form.reset()},5e3)):(displayNotification(n.message,"error"),setTimeout(()=>{init.animateButton("error")},0))}catch(e){console.error("Form submission error:",e.message,e.stack),handleError(r,e)}finally{e.disabled=!1,setTimeout(()=>{init.resetButton()},5e3)}}function handleError(e,t){Sentry.captureException(t,{attachments:[{filename:"form_data.txt",data:e,contentType:"text/plain"}],tags:{"form-name":"kontakt"},extra:{url:window.location.href,referrer:document.referrer,userAgent:navigator.userAgent,formData:e,formMethod:"POST",formAction:"../php/send_email.php",formError:t.message,formErrorStack:t.stack,formErrorName:t.name,formErrorMessage:t.message}}),t.message.includes("Błąd")?displayNotification("Wystąpił błąd. Proszę spróbować ponownie.","error"):displayNotification("Wystąpił nieoczekiwany błąd. Proszę skontaktować się z administratorem.","error")}document.addEventListener("DOMContentLoaded",()=>{document.getElementById("phone").addEventListener("input",phoneFormatter),checkCsrfToken(),phoneFormatter()}),form.addEventListener("submit",t=>{t.preventDefault(),fetch("../config.json").then(e=>e.text()).then(e=>{e=JSON.parse(e);executeReCAPTCHA(t,e.recaptchaSiteKey)}).catch(e=>{console.error("Error loading config:",e)})});
//# sourceMappingURL=send_email.js.map
