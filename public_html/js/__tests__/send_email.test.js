import{jest}from"@jest/globals";import displayNotification from"../modules/notification";import phoneFormatter from"../modules/phone-format";import initButtonAnimation from"../modules/button-animation";jest.mock("../modules/notification"),jest.mock("../modules/phone-format"),jest.mock("../modules/button-animation"),describe("Form Submission Handler",()=>{let a,o;beforeEach(()=>{(a=document.createElement("form")).id="my-form",(o=document.createElement("button")).type="submit",a.appendChild(o);["email","phone","name","message","csrf-token"].forEach(e=>{var t=document.createElement("input");t.id=e,t.value="test-"+e,a.appendChild(t)}),document.body.appendChild(a),global.fetch=jest.fn(),global.localStorage={getItem:jest.fn(),setItem:jest.fn()}}),afterEach(()=>{document.body.innerHTML="",jest.clearAllMocks()}),test("generateCsfrToken fetches and stores token correctly",async()=>{let e="test-token";global.fetch.mockResolvedValueOnce({text:()=>Promise.resolve(e)}),await generateCsfrToken(),expect(global.fetch).toHaveBeenCalledWith("/php/generate-token.php"),expect(localStorage.setItem).toHaveBeenCalledWith("csrf_token",e),expect(document.getElementById("csrf-token").value).toBe(e)}),test("validateFormData handles validation success",async()=>{global.fetch.mockResolvedValueOnce({json:()=>Promise.resolve({success:!0})});var e=await validateFormData(o,{email:"test@example.com",phone:"123456789",name:"Test User",message:"Test message"});expect(e).toBe(!0)}),test("validateFormData handles validation error",async()=>{global.fetch.mockResolvedValueOnce({json:()=>Promise.resolve({error:"Validation failed"})}),await expect(validateFormData(o,{email:"invalid-email",phone:"",name:"",message:""})).rejects.toThrow("Validation failed"),expect(displayNotification).toHaveBeenCalledWith("Validation failed","error")}),test("sendDataToServer handles successful submission",async()=>{var e=new FormData,t=new File(["{}"],"test.txt");global.fetch.mockResolvedValueOnce({ok:!0,json:()=>Promise.resolve({success:!0,message:"Success"})}),await sendDataToServer(o,e,t),expect(displayNotification).toHaveBeenCalledWith("Success","success"),expect(o.disabled).toBe(!1)}),test("sendDataToServer handles submission error",async()=>{var e=new FormData,t=new File(["{}"],"test.txt");global.fetch.mockRejectedValueOnce(new Error("Network error")),await sendDataToServer(o,e,t),expect(displayNotification).toHaveBeenCalledWith("Wystąpił nieoczekiwany błąd. Proszę skontaktować się z administratorem.","error"),expect(o.disabled).toBe(!1)}),describe("getFormData",()=>{test("returns correctly formatted form data",()=>{var e=getFormData();expect(e).toEqual({email:"test-email",phone:"test-phone",name:"test-name",message:"test-message"})}),test("strips non-digits from phone number",()=>{document.getElementById("phone").value="+1 (234) 567-8900";var e=getFormData();expect(e.phone).toBe("12345678900")})}),describe("prepareData",()=>{test("creates FormData with all required fields",()=>{var e={email:"test@example.com",phone:"123456789",name:"Test User",message:"Test message"},t="test-token",a=prepareData(e,t);expect(a instanceof FormData).toBe(!0),expect(a.get("email")).toBe(e.email),expect(a.get("phone")).toBe(e.phone),expect(a.get("name")).toBe(e.name),expect(a.get("message")).toBe(e.message),expect(a.get("g-recaptcha-response")).toBe(t),expect(a.get("csrf_token")).toBeDefined(),expect(a.get("uniqueID")).toBeDefined()})}),describe("handleError",()=>{beforeEach(()=>{global.Sentry={captureException:jest.fn()}}),test("captures exception with correct data",()=>{var e=new File(["{}"],"test.txt"),t=new Error("Test error");handleError(e,t),expect(Sentry.captureException).toHaveBeenCalledWith(t,expect.objectContaining({tags:{"form-name":"kontakt"},attachments:expect.arrayContaining([expect.objectContaining({filename:"form_data.txt",contentType:"text/plain"})])}))}),test("displays correct error message for known errors",()=>{var e=new File(["{}"],"test.txt"),t=new Error("Błąd 404");handleError(e,t),expect(displayNotification).toHaveBeenCalledWith("Wystąpił błąd. Proszę spróbować ponownie.","error")}),test("displays generic error message for unknown errors",()=>{var e=new File(["{}"],"test.txt"),t=new Error("Unknown error");handleError(e,t),expect(displayNotification).toHaveBeenCalledWith("Wystąpił nieoczekiwany błąd. Proszę skontaktować się z administratorem.","error")})})});
//# sourceMappingURL=send_email.test.js.map
